<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nightmare Shooter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');

        body {
            overflow: hidden;
            touch-action: none;
            font-family: 'Creepster', cursive;
            background-color: #000;
        }

        .target {
            transition: transform 0.1s;
            position: absolute;
            cursor: crosshair;
            user-select: none;
        }

        .target:hover {
            transform: scale(1.1);
        }

        .blood-splatter {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
            z-index: 10;
        }

        .gun-sight {
            position: fixed;
            width: 40px;
            height: 40px;
            pointer-events: none;
            z-index: 100;
            mix-blend-mode: difference;
        }

        .blood-drip {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent 90%, rgba(150, 0, 0, 0.3) 90%);
            background-size: 100% 10px;
            animation: bloodDrip 3s linear infinite;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes bloodDrip {
            0% { background-position: 0 0; }
            100% { background-position: 0 10px; }
        }

        .flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            pointer-events: none;
            opacity: 0;
            z-index: 20;
            transition: opacity 0.1s;
        }

        .touch-counter {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: red;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate(-1px, 0); }
            20%, 80% { transform: translate(2px, 0); }
            30%, 50%, 70% { transform: translate(-4px, 0); }
            40%, 60% { transform: translate(4px, 0); }
        }

        @media (max-width: 640px) {
            .game-container {
                height: 100vh !important;
            }
        }
    </style>
</head>
<body class="text-white select-none">
    <div class="blood-drip"></div>
    <div class="flash" id="flash"></div>
    <div class="touch-counter" id="touchCounter">0</div>

    <div class="fixed top-0 left-0 w-full bg-black bg-opacity-70 z-50 p-4 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <div class="text-red-500 text-2xl">
                <i class="fas fa-skull"></i>
                <span id="score" class="ml-2">0</span>
            </div>
        </div>
        <div class="flex items-center space-x-4">
            <div class="text-green-400 text-xl">
                <i class="fas fa-heart"></i>
                <span id="health" class="ml-2">100</span>%
            </div>
            <div class="text-blue-400 text-xl">
                <i class="fas fa-stopwatch"></i>
                <span id="time" class="ml-2">60</span>s
            </div>
        </div>
    </div>

    <div class="game-container relative w-full h-screen bg-black overflow-hidden" id="gameContainer">
        <div class="gun-sight" id="gunSight">
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 border-2 border-red-500 rounded-full"></div>
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full"></div>
        </div>
    </div>

    <audio id="gunshot" src="./audio/Gunshot.m4a" preload="auto"></audio>
    <audio id="scream1" src="./audio/ghost1.m4a" preload="auto"></audio>
    <audio id="scream2" src="./audio/Up.m4a" preload="auto"></audio>
    <audio id="scream3" src="./audio/ghost2.m4a" preload="auto"></audio>
    <audio id="scream4" src="./audio/scream.m4a" preload="auto"></audio>
    <audio id="gamedown" src="./audio/gamedown.m4a" preload="auto"></audio>
    <audio id="ambient" src="" loop preload="auto"></audio>
    <audio id="up" src="./audio/Up.m4a" preload="auto"></audio>

    <script>
        // Game variables
        let score = 0;
        let health = 100;
        let timeLeft = 60;
        let gameActive = false;
        let touchCount = 0;
        let gameInterval;
        let targetInterval;
        let timeInterval;
        let targets = [];
        const screams = ['scream1', 'scream2', 'scream3', 'scream4'];

        // DOM elements
        const gameContainer = document.getElementById('gameContainer');
        const scoreElement = document.getElementById('score');
        const healthElement = document.getElementById('health');
        const timeElement = document.getElementById('time');
        const gunSight = document.getElementById('gunSight');
        const flash = document.getElementById('flash');
        const touchCounter = document.getElementById('touchCounter');

        // Audio elements
        const gunshot = document.getElementById('gunshot');
        const ambientSound = document.getElementById('ambient');
        const gamedownSound = document.getElementById('gamedown');

        // Start game automatically when page loads
        window.onload = startGame;

        // Mouse movement for gun sight
        document.addEventListener('mousemove', (e) => {
            gunSight.style.left = `${e.clientX - 20}px`;
            gunSight.style.top = `${e.clientY - 20}px`;
        });

        // Touch movement for mobile
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            gunSight.style.left = `${touch.clientX - 20}px`;
            gunSight.style.top = `${touch.clientY - 20}px`;

            // Show touch counter when multi-touch
            touchCount = e.touches.length;
            if (touchCount > 1) {
                touchCounter.textContent = touchCount;
                touchCounter.style.opacity = '1';
            } else {
                touchCounter.style.opacity = '0';
            }
        });

        // Click/touch to shoot
        document.addEventListener('click', shoot);
        document.addEventListener('touchstart', (e) => {
            touchCount = e.touches.length;
            shoot(e);
        });
        document.addEventListener('touchend', () => {
            touchCount = 0;
        });

        function startGame() {
            if (gameActive) return;

            // Reset game state
            score = 0;
            health = 100;
            timeLeft = 60;
            gameActive = true;

            // Update UI
            scoreElement.textContent = score;
            healthElement.textContent = health;
            timeElement.textContent = timeLeft;

            // Start game loop
            ambientSound.play();

            // Spawn targets
            targetInterval = setInterval(spawnTarget, 800);

            // Timer
            timeInterval = setInterval(() => {
                timeLeft--;
                timeElement.textContent = timeLeft;

                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            // Game difficulty increases over time
            setTimeout(() => {
                if (gameActive) {
                    clearInterval(targetInterval);
                    targetInterval = setInterval(spawnTarget, 500);
                }
            }, 20000);

            // Play gamedown sound randomly
            const playRandomGamedown = () => {
                if (gameActive && Math.random() < 0.3) { // 30% chance
                    gamedownSound.currentTime = 0;
                    gamedownSound.play();
                }
                if (gameActive) {
                    setTimeout(playRandomGamedown, Math.random() * 10000 + 5000); // 5-15秒間隔
                }
            };
            setTimeout(playRandomGamedown, Math.random() * 5000 + 3000); // 3-8秒後に開始
        }

        function endGame() {
            gameActive = false;
            clearInterval(targetInterval);
            clearInterval(timeInterval);
            ambientSound.pause();
            ambientSound.currentTime = 0;

            // Remove all targets
            document.querySelectorAll('.target').forEach(target => target.remove());
            document.querySelectorAll('.blood-splatter').forEach(splatter => splatter.remove());
            targets = [];

            // Show game over message
            const gameOver = document.createElement('div');
            gameOver.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-80 p-8 rounded-lg text-center z-50';
            gameOver.innerHTML = `
                <h2 class="text-4xl text-red-500 mb-4">GAME OVER</h2>
                <p class="text-2xl mb-6">Your score: <span class="text-yellow-400">${score}</span></p>
                <button onclick="this.parentElement.remove()" class="bg-red-700 hover:bg-red-600 text-white px-6 py-2 rounded-lg">
                    Close
                </button>
            `;
            gameContainer.appendChild(gameOver);
        }

        function spawnTarget() {
            if (!gameActive) return;

            const target = document.createElement('div');
            target.className = 'target';

            // Random position (avoid edges)
            const x = Math.random() * (window.innerWidth - 150) + 50;
            const y = Math.random() * (window.innerHeight - 150) + 50;

            // Random scary face
            const faces = ['👹', '👻', '💀', '👽', '🤡', '👺', '🧟', '🧛'];
            const face = faces[Math.floor(Math.random() * faces.length)];

            // Random size and speed
            const size = Math.random() * 60 + 40;
            const speed = Math.random() * 3 + 1;

            target.style.left = `${x}px`;
            target.style.top = `${y}px`;
            target.style.fontSize = `${size}px`;
            target.textContent = face;

            // Add target to DOM
            gameContainer.appendChild(target);

            // Animate target movement
            let directionX = Math.random() > 0.5 ? 1 : -1;
            let directionY = Math.random() > 0.5 ? 1 : -1;

            const moveTarget = setInterval(() => {
                if (!gameActive) {
                    clearInterval(moveTarget);
                    return;
                }

                const currentX = parseFloat(target.style.left);
                const currentY = parseFloat(target.style.top);

                // Bounce off edges
                if (currentX <= 0 || currentX >= window.innerWidth - size) {
                    directionX *= -1;
                }
                if (currentY <= 0 || currentY >= window.innerHeight - size) {
                    directionY *= -1;
                }

                target.style.left = `${currentX + (speed * directionX)}px`;
                target.style.top = `${currentY + (speed * directionY)}px`;
            }, 20);

            // Store target data
            targets.push({
                element: target,
                moveInterval: moveTarget,
                health: 2, // Takes 2 hits to kill
                size: size
            });

            // Remove target after some time if not killed
            setTimeout(() => {
                if (target.parentNode) {
                    clearInterval(moveTarget);
                    target.remove();
                    targets = targets.filter(t => t.element !== target);

                    // Player loses health if target escapes
                    if (gameActive) {
                        health -= 5;
                        healthElement.textContent = health;

                        if (health <= 0) {
                            endGame();
                        }
                    }
                }
            }, 8000);
        }

        function shoot(e) {
            if (!gameActive) return;

            // Play gunshot sound
            gunshot.currentTime = 0;
            gunshot.play();

            // Screen flash - intensity based on touch count
            const flashIntensity = Math.min(0.3 + (touchCount * 0.2), 0.9);
            flash.style.opacity = flashIntensity;
            setTimeout(() => {
                flash.style.opacity = 0;
            }, 50 + (touchCount * 20));

            // Get click position
            let x, y;
            if (e.type === 'touchstart') {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }

            // Check if any target was hit
            let hit = false;
            targets.forEach(target => {
                const targetRect = target.element.getBoundingClientRect();

                if (
                    x >= targetRect.left &&
                    x <= targetRect.right &&
                    y >= targetRect.top &&
                    y <= targetRect.bottom
                ) {
                    hit = true;
                    target.health--;

                    // Create blood splatter
                    createBloodSplatter(x, y, target.size);

                    if (target.health <= 0) {
                        // Target killed
                        clearInterval(target.moveInterval);
                        target.element.remove();
                        targets = targets.filter(t => t !== target);

                        // Play random scream
                        const scream = document.getElementById(screams[Math.floor(Math.random() * screams.length)]);
                        scream.currentTime = 0;
                        scream.play();

                        // Add score
                        score += 10;
                        scoreElement.textContent = score;
                    } else {
                        // Target hit but not killed
                        target.element.classList.add('shake');
                        setTimeout(() => {
                            target.element.classList.remove('shake');
                        }, 500);
                    }
                }
            });

            if (!hit) {
                // Missed shot - bigger splatter with more touches
                const baseSize = 30;
                const multiTouchBonus = touchCount * 20;
                createBloodSplatter(x, y, baseSize + multiTouchBonus);
            }
        }

        function createBloodSplatter(x, y, size) {
            const splatter = document.createElement('div');
            splatter.className = 'blood-splatter';

            // Random blood splatter shape
            const splatters = [
                'radial-gradient(circle, transparent 20%, rgba(150, 0, 0, 0.8) 20%, rgba(150, 0, 0, 0.8) 35%, transparent 35%)',
                'radial-gradient(circle, transparent 10%, rgba(150, 0, 0, 0.7) 10%, rgba(150, 0, 0, 0.7) 20%, transparent 20%)',
                'radial-gradient(ellipse, transparent 15%, rgba(150, 0, 0, 0.6) 15%, rgba(150, 0, 0, 0.6) 30%, transparent 30%)'
            ];

            splatter.style.left = `${x - size/2}px`;
            splatter.style.top = `${y - size/2}px`;
            splatter.style.width = `${size}px`;
            splatter.style.height = `${size}px`;
            splatter.style.backgroundImage = splatters[Math.floor(Math.random() * splatters.length)];
            splatter.style.transform = `rotate(${Math.random() * 360}deg) scale(${Math.random() * 0.5 + 0.5})`;

            gameContainer.appendChild(splatter);

            // Fade out blood splatter
            setTimeout(() => {
                splatter.style.opacity = '0';
                setTimeout(() => {
                    splatter.remove();
                }, 1000);
            }, 3000);
        }
    </script>
</body>
</html>
